{{ block title }}Survey 2{{ endblock }}
{{ block content }}
<!-- <div style="background-color: #808080; padding: 20px;"> -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <!-- <script src="https://code.highcharts.com/modules/export-data.js"></script> -->
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
<p>&nbsp;</p>

<script>
        // Function to be executed when the page is fully loaded
        console.log("on load called")
        window.onload = function() {
            let string_ = "load" 
            sendResultAndUpdate(string_);
        };
</script>
<figure class="table" style="width:100%;">
    <table class="ck-table-resized">
        <colgroup>
            <col style="width:100%;">
        </colgroup>
        <tbody>
            <tr>
                <td>
                    <figure class="highcharts-figure" style="display: block">
                        <div id="container"></div>
                      </figure>
                    <p>&nbsp;</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p style="line-height:107%;margin-bottom:0.11in;"><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">Your initial earnings are <strong>$25.00</strong>.</span></font>
                        </span></p>
                    <p style="line-height:107%;margin-bottom:0.11in;"><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">When the lottery is played out, there is a <strong>10%</strong> chance that you will </span></font>
                        </span><span style="color:#ff0000;font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr"><strong>lose $20.00</strong></span></font>
                        </span><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">. However, there is a <strong>90%</strong> chance that you will </span></font>
                        </span><span style="color:#388600;font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr"><strong>not lose any money</strong></span></font>
                        </span><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">.&nbsp;</span></font>
                        </span></p>
                    <p style="line-height:107%;margin-bottom:0.11in;">&nbsp;</p>
                    <p style="line-height:107%;margin-bottom:0.11in;"><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">If a loss occurs, you will be </span></font>
                        </span><span style="color:#ff0000;font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr"><strong>left with $5.00</strong></span></font>
                        </span><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">, else your earnings will </span></font>
                        </span><span style="color:#388600;font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr"><strong>remain at $25</strong></span></font>
                        </span><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">.</span></font>
                        </span></p>
                    <p style="line-height:107%;margin-bottom:0.11in;">&nbsp;</p>
                    <p style="line-height:107%;margin-bottom:0.11in;margin-right:-0.13in;" lang="en-US"><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;">You have the option to purchase insurance, which will help avoid that potential loss completely.&nbsp;</font>
                        </span></p>
                    <ul>
                        <li>
                            <p style="line-height:107%;margin-bottom:0.11in;margin-left:0.5in;"><span style="font-family:Times New Roman, serif;font-size:large;">
                                    <font style="font-size:14pt;"><span lang="en-US" dir="ltr">You can but the insurance at price </span></font>
                                </span><span style="color:#0000ff;font-family:Times New Roman, serif;font-size:large;">
                                    <font style="font-size:14pt;"><span lang="en-US" dir="ltr"><strong>$2.25</strong></span></font>
                                </span><span style="font-family:Times New Roman, serif;font-size:large;">
                                    <font style="font-size:14pt;"><span lang="en-US" dir="ltr">.</span></font>
                                </span></p>
                        </li>
                        <li>
                            <p style="line-height:107%;margin-bottom:0.11in;margin-left:0.5in;"><span style="font-family:Times New Roman, serif;font-size:large;">
                                    <font style="font-size:14pt;"><span lang="en-US" dir="ltr">If you choose to insure against the loss, your final earnings will be </span></font>
                                </span><span style="color:#0000ff;font-family:Times New Roman, serif;font-size:large;">
                                    <font style="font-size:14pt;"><span lang="en-US" dir="ltr"><strong>$22.75</strong></span></font>
                                </span><span style="font-family:Times New Roman, serif;font-size:large;">
                                    <font style="font-size:14pt;"><span lang="en-US" dir="ltr">.</span></font>
                                </span></p>
                            <p style="line-height:107%;margin-bottom:0.11in;margin-left:0.5in;">&nbsp;</p>
                        </li>
                    </ul>
                    <p style="line-height:107%;margin-bottom:0.11in;" lang="en-US"><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;">Would you like to purchase insurance against the loss of $20.00 for $2.25? &nbsp;</font>
                        </span></p>
                </td>
            </tr>
        </tbody>
    </table>
</figure>

<p> <span id="prev_reward" style="color: blue"> Loading screen please wait....</span> </p>

<script>
    function sendResultAndUpdate(_string){
        if(_string == "load"){
            document.getElementById("prev_reward").innerHTML = "Loading please wait";
        }
        liveSend(_string);
    }
    function liveRecv(data){
        let is_done = data["is_done"];
        let exp_data = data["exp_data"];
        let option_selected = data["option_selected"];
        const left_button = document.getElementById("left");
        const right_button = document.getElementById("right");
        //TODO: which button was clicked and whichreward was recieved

        if (option_selected != "load"){
        document.getElementById("prev_reward").innerHTML = "You earned a reward of: $" +
            data["prev_reward"] + " by choosing the option on the \""+  option_selected + "\"." ; 
        }
        if (is_done =='game_finished') {
            document.getElementById("form").submit();
        }
        var parsed_left_chart_data = JSON.parse(exp_data["pieleft"]); 
        var parsed_right_chart_data = JSON.parse(exp_data["pieright"]);
        if (option_selected == "load"){
                document.getElementById("prev_reward").innerHTML = "";
                redrawChart(parsed_left_chart_data,parsed_right_chart_data);
                rewriteCharttext(parsed_left_chart_data,parsed_right_chart_data);
        } else{
            left_button.disabled = true;
            right_button.disabled = true;
            setTimeout(function() {
                //wait before update
                document.getElementById("prev_reward").innerHTML = "";
                redrawChart(parsed_left_chart_data,parsed_right_chart_data);
                rewriteCharttext(parsed_left_chart_data,parsed_right_chart_data);
                left_button.disabled = false;
                right_button.disabled = false;
            }, 20);
        }
    }

    function rewriteCharttext(data_field_left,data_field_right){
        let colors = ["#2CAFFE","#544FC5","#00E272","#FE6A35"]; //change colors
        for (let i = 0; i < 4; i++) {
            //for now hardcode to max 4 elemetns
            let variable_left = document.getElementById("left_text_" + i);
            let string_field_left = "";
            if (parseFloat(data_field_left[i]["y"]) != 0){//maybe parse 
                variable_left.style.color = colors[i];
                var percentage = data_field_left[i]["y"]*100
                variable_left.innerHTML = "Chance of winnning " + data_field_left[i]["name"] + " is " + percentage.toFixed(0) + "%" ;
            }else{

                variable_left.innerHTML = "";
            }
            let variable_right = document.getElementById("right_text_" + i);
            if (parseFloat(data_field_right[i]["y"]) != 0){//maybe parse 
                variable_right.style.color = colors[i];
                var percentage = data_field_right[i]["y"]*100
                variable_right.innerHTML = "Chance of winnning " + data_field_right[i]["name"] + " is " + percentage.toFixed(0) + "%" ;
            }else{

                variable_right.innerHTML = "";
            }
        }
    }

    // Build the chart left
        Highcharts.chart('container', {
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false,
                type: 'pie'
            },
            credits: {
                enabled: false 
            },
            title: {
                text: 'Left',
                align: 'center'
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            accessibility: {
                point: {
                    valueSuffix: '%'
                }
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: true,
                        distance: 0,
                        formatter: function(){
                            if (this.y > 0) {
                              return this.point.name;
                            }
                        },
                        connectorColor: 'rgba(128,128,128,0.5)',
                    }
                }
            },
            series: [{ name: 'Percentage',
                       colors: ["green","red"],
                       data: [
                           {
                               name: '$0',
                               y: 90
                           },
                           {
                               name: '$15',
                               y: 10
                           },
                       ]
                    }
                ]
        });

        // Build the chart right
</script>

{{ endblock }}
