{{ block title }}Probabilty of Loss{{ endblock }}
{{ block content }}
<!-- <div style="background-color: #808080; padding: 20px;"> -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <!-- <script src="https://code.highcharts.com/modules/export-data.js"></script> -->
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
<p>&nbsp;</p>

<script>
        // Function to be executed when the page is fully loaded
        window.onload = function() {
            let string_ = "load" 
            answerSelection(string_);
        };
</script>
<figure class="table" style="width:100%;">
    <table class="ck-table-resized">
        <colgroup>
            <col style="width:100%;">
        </colgroup>
        <tbody>
            <tr>
                <td>
                    <figure class="highcharts-figure" style="display: block">
                        <div id="container"></div>
                      </figure>
                    <p>&nbsp;</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p style="line-height:107%;margin-bottom:0.11in;"><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">Your initial
                                    earnings are <strong>${{ group.initial_earning }}</strong>.</span></font>
                        </span></p>
                    <p style="line-height:107%;margin-bottom:0.11in;"><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">When the
                                    lottery is played out, there is a <strong>
                                        {{group.loss_probability}} %</strong> chance that you will
                                    loose </span></font>
                        </span><span style="color:#ff0000;font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr"><strong>${{group.loss}}</strong></span></font>
                        </span><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">. However, there is a <strong>90%</strong> chance that you will </span></font>
                        </span><span style="color:#388600;font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr"><strong>not lose any money</strong></span></font>
                        </span><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">.&nbsp;</span></font>
                        </span></p>
                    <p style="line-height:107%;margin-bottom:0.11in;">&nbsp;</p>
                    <p style="line-height:107%;margin-bottom:0.11in;"><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">If a loss occurs, you will be </span></font>
                        </span><span style="color:#ff0000;font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr"><strong>left with $5.00</strong></span></font>
                        </span><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">, else your earnings will </span></font>
                        </span><span style="color:#388600;font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US"
                                                                dir="ltr"><strong>remain at ${{group.initial_earning}}</strong></span></font>
                        </span><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;"><span lang="en-US" dir="ltr">.</span></font>
                        </span></p>
                    <p style="line-height:107%;margin-bottom:0.11in;">&nbsp;</p>
                    <p style="line-height:107%;margin-bottom:0.11in;margin-right:-0.13in;" lang="en-US"><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;">You have the option to purchase insurance, which will help avoid that potential loss completely.&nbsp;</font>
                        </span></p>
                    <ul>
                        <li>
                            <p style="line-height:107%;margin-bottom:0.11in;margin-left:0.5in;"><span style="font-family:Times New Roman, serif;font-size:large;">
                                    <font style="font-size:14pt;"><span lang="en-US" dir="ltr">You can buy the insurance at price </span></font>
                                </span><span style="color:#0000ff;font-family:Times New Roman, serif;font-size:large;">
                                    <font style="font-size:14pt;"><strong><span lang="en-US" dir="ltr" id="premium">$2.5</span></strong></font>
                                </span><span style="font-family:Times New Roman, serif;font-size:large;">
                                    <font style="font-size:14pt;"><span lang="en-US" dir="ltr">.</span></font>
                                </span></p>
                        </li>
                        <li>
                            <p style="line-height:107%;margin-bottom:0.11in;margin-left:0.5in;"><span style="font-family:Times New Roman, serif;font-size:large;">
                                    <font style="font-size:14pt;"><span lang="en-US" dir="ltr">If you choose to insure against the loss, your final earnings will be </span></font>
                                </span><span style="color:#0000ff;font-family:Times New Roman, serif;font-size:large;">
                                    <font style="font-size:14pt;"> <strong><span lang="en-US" dir="ltr" id="init_minus_premium"></span></strong></font>
                                </span><span style="font-family:Times New Roman, serif;font-size:large;">
                                    <font style="font-size:14pt;"><span lang="en-US" dir="ltr">.</span></font>
                                </span></p>
                            <p style="line-height:107%;margin-bottom:0.11in;margin-left:0.5in;">&nbsp;</p>
                        </li>
                    </ul>
                    <p style="line-height:107%;margin-bottom:0.11in;" lang="en-US"><span style="font-family:Times New Roman, serif;font-size:large;">
                            <font style="font-size:14pt;">Would you like to purchase insurance
                                against the loss of <strong>${{group.loss}}</strong> for
                                <strong><span id="premium1"></span></strong>? &nbsp;</font>
                        </span>
                    <form>
                        <label style="margin-right: 20px;">
                            <input id="yes" type="radio" name="like" onclick=answerSelection(this.value) value="yes">
                            Yes 
                        </label>
                        <label>
                            <input id="no" type="radio" name="like" value="no" onclick=answerSelection(this.value)>
                            No
                        </label>
                    </form>
                    </p>
                </td>
            </tr>
        </tbody>
    </table>
</figure>

<p style="font-family:Times New Roman, serif;font-size:large;"> <span id="reward" style="color: blue"></span> </p>

<script>
     function answerSelection(value) {
        // Get all radio buttons with name "like"
         liveSend(value);
         console.log("clicked event is", value);
        }
     function writeVariables(data){
        document.getElementById("premium").innerHTML = "$"+data["exp_data"]["premium"];
        document.getElementById("premium1").innerHTML = "$"+  data["exp_data"]["premium"];
         console.log(data["exp_data"]["final_earning"])
        document.getElementById("init_minus_premium").innerHTML = "$" + data["exp_data"]["final_earning"];
     }


    function liveRecv(data){
         console.log(data);
        let is_done = data["is_done"];
        let option_selected = data["option_selected"];
        const yes_button = document.getElementById("yes");
        const no_button = document.getElementById("no");

        if (option_selected != "load"){
        document.getElementById("reward").innerHTML = "You earned a reward of: $" +
            data["reward"] + " by choosing the option on the \""+  option_selected + "\"." ; 
        }
        if (is_done =='game_finished') {
            document.getElementById("form").submit();
        }
        if (option_selected == "load"){
                document.getElementById("reward").innerHTML = "";
                writeVariables(data)
        } else{
            yes_button.disabled = true;
            no_button.disabled = true;
            setTimeout(function() {
                //wait before update
                document.getElementById("reward").innerHTML = "";
                writeVariables(data)
                yes_button.disabled = false;
                no_button.disabled = false;
                yes_button.checked = false;
                no_button.checked = false;
            }, 2000);
        }
    }

    Highcharts.chart('container', {
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false,
            type: 'pie'
        },
        credits: {
            enabled: false 
        },
        title: {
            text: '',
            align: 'center'
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        accessibility: {
            point: {
                valueSuffix: '%'
            }
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    distance: 0,
                    formatter: function(){
                        if (this.y > 0) {
                          return this.point.name;
                        }
                    },
                    connectorColor: 'rgba(128,128,128,0.5)',
                }
            }
        },
        series: [{ name: 'Percentage',
                   colors: ["green","red"],
                   data: [
                       {
                           name: '$0',
                           y: 90
                       },
                       {
                           name: '$15',
                           y: 10
                       },
                   ]
                }
            ]
    });

</script>

{{ endblock }}
